<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Walmart Dashboard - Stock Status</title>
  <link rel="icon" href="./assets/logo.png" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Neuton:ital,wght@0,200;0,300;0,400;0,700;0,800;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body { font-family: 'Montserrat', sans-serif; }
    .fade-in { opacity: 0; transform: translateY(20px); animation: fadeInUp 0.8s ease-out forwards; }
    @keyframes fadeInUp {
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-t from-violet-500 via-pink-300 to-white fade-in">

<!-- Navbar -->
<div class="flex justify-between items-center bg-violet-800 px-6 h-24 text-white" class="bg-white shadow-lg rounded-xl p-4 w-72 transform transition duration-500 hover:scale-105 hover:shadow-xl">
  <div>
    <img src="https://upload.wikimedia.org/wikipedia/commons/c/ca/Walmart_logo.svg" alt="Walmart Logo" class="h-20">
  </div>
  <div class="flex items-center gap-6 text-lg font-semibold">
    <!-- Alerts Button -->
<div class="relative">
  <button onclick="toggleAlerts()" class="flex items-center gap-2 text-white text-lg font-semibold hover:underline focus:outline-none">
    <i class="fa-solid fa-bell text-2xl"></i>
    <span>Alerts</span>
    {% if alerts and alerts|length > 0 %}
      <span class="ml-1 bg-red-500 text-white text-xs px-2 py-0.5 rounded-full animate-pulse">
        {{ alerts|length }}
      </span>
    {% endif %}
  </button>


  <!-- Notification Popup -->
  <div id="alertBox" class="hidden absolute right-0 mt-2 w-80 bg-white text-black rounded shadow-lg z-50">
    <div class="p-4 border-b font-semibold text-red-600">ðŸ”” Critical Alerts</div>
    <ul class="max-h-60 overflow-y-auto">
      {% if alerts %}
        {% for msg in alerts %}
        <li class="px-4 py-3 border-b hover:bg-gray-100">
          {{ msg }}
        </li>
        {% endfor %}
      {% else %}
        <li class="px-4 py-3 text-gray-500">
          âœ… No critical alerts
        </li>
      {% endif %}
    </ul>
  </div>
</div>

    <a href="/logout" class="hover:underline text-white text-base font-bold flex items-center gap-1">
  <i class="fa-solid fa-right-from-bracket"></i>
  Logout
</a>

  </div>
</div>

<!-- Tabs -->
<div class="bg-gray-100 px-6 py-4 flex gap-3 justify-center">
  <button class="bg-white border px-5 py-2 rounded shadow text-sm font-semibold hover:bg-gray-200" onclick="window.location.href='/dashboard'">Predict Sales</button>
   <button class="bg-white border px-5 py-2 rounded shadow text-sm font-semibold hover:bg-gray-200" onclick="window.location.href='/top-store-metrics'">
      Retail Intelligence
    </button>
    <button class="bg-white border px-5 py-2 rounded shadow text-sm font-semibold hover:bg-gray-200" onclick="window.location.href='/status'">
      Graphical Insights
    </button>
  <button class="bg-gray-800 text-white px-5 py-2 rounded shadow text-sm font-semibold">Stock Status</button>
  <button class="bg-white border px-5 py-2 rounded shadow text-sm font-semibold hover:bg-gray-200" onclick="window.location.href='/addstock'">Add New Item</button>
  <button class="bg-white border px-5 py-2 rounded shadow text-sm font-semibold hover:bg-gray-200" onclick="window.location.href='/billing'">Billing Counter</button>
</div>

<!-- Search + Filter -->
<div class="flex justify-between items-center mt-6 px-6">
  <div class="relative w-full max-w-md">
    <input id="searchInput" type="text" placeholder="Search" class="border px-4 py-2 rounded w-full pl-10">
    <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 text-sm"></i>
  </div>
  <button onclick="toggleFilter()" class="ml-4 bg-gray-200 px-4 py-2 rounded flex items-center">
    <i class="fa fa-filter mr-2"></i>Filter
  </button>
</div>

<!-- Filter Popup -->
<div id="filterPopup" class="hidden mt-4 ml-6 bg-white p-4 shadow rounded w-full max-w-sm">
  <p class="font-semibold mb-2">Filter Options:</p>
  <details><summary class="font-semibold">Category</summary>
    <div class="pl-4 mt-1 space-y-1">
      {% for cat in categories %}
      <label><input type="checkbox" class="mr-2 filter-checkbox" data-filter="category" value="{{ cat }}">{{ cat }}</label>
      {% endfor %}
    </div>
  </details>
  <details class="mt-3"><summary class="font-semibold">Brand</summary>
    <div class="pl-4 mt-1 space-y-1">
      {% for brand in brands %}
      <label><input type="checkbox" class="mr-2 filter-checkbox" data-filter="brand" value="{{ brand }}">{{ brand }}</label>
      {% endfor %}
    </div>
  </details>
  <details class="mt-3"><summary class="font-semibold">Availability</summary>
    <div class="pl-4 mt-1 space-y-1">
      <label><input type="checkbox" class="mr-2 filter-checkbox" data-filter="availability" value="In Stock">In Stock</label>
      <label><input type="checkbox" class="mr-2 filter-checkbox" data-filter="availability" value="Out of Stock">Out of Stock</label>
    </div>
  </details>
  <details class="mt-3"><summary class="font-semibold">Price Range</summary>
    <div class="pl-4 mt-1 space-y-1">
      <label><input type="checkbox" class="mr-2 filter-checkbox" data-filter="price" value="Low">Low</label>
      <label><input type="checkbox" class="mr-2 filter-checkbox" data-filter="price" value="Medium">Medium</label>
      <label><input type="checkbox" class="mr-2 filter-checkbox" data-filter="price" value="High">High</label>
    </div>
  </details>
  <details class="mt-3"><summary class="font-semibold">Rating</summary>
    <div class="pl-4 mt-1 space-y-1">
      {% for r in [1,2,3,4,5] %}
      <label><input type="checkbox" class="mr-2 filter-checkbox" data-filter="rating" value="{{ r }}">{{ r }} Star{% if r > 1 %}s{% endif %}</label>
      {% endfor %}
    </div>
  </details>
</div>

<!-- Product Cards -->
<div id="productContainer" class="mt-6 px-6 space-y-4">
  {% for product in products %}
    {% set percent = (product.stock_quantity / 200 * 100) | round(0) %}
    {% if percent > 70 %}
      {% set level = 'Good' %}
      {% set color = 'bg-green-500' %}
      {% set tag = 'text-green-600' %}
    {% elif percent > 30 %}
      {% set level = 'Moderate' %}
      {% set color = 'bg-yellow-400' %}
      {% set tag = 'text-yellow-500' %}
    {% else %}
      {% set level = 'Critical' %}
      {% set color = 'bg-red-500' %}
      {% set tag = 'text-red-600' %}
    {% endif %}

    <div class="product-card bg-white p-4 shadow rounded transition hover:scale-[1.02] duration-300"
         data-category="{{ product.category }}"
         data-brand="{{ product.brand }}"
         data-availability="{{ product.availability }}"
         data-price="{{ product.price_range }}"
         data-rating="{{ product.rating }}">
      <div class="flex justify-between">
        <h2 class="text-lg font-semibold">{{ product.item_name }}</h2>
        <span class="font-semibold {{ tag }}">{{ level }}</span>
      </div>
      <p class="text-sm text-gray-500">{{ product.stock_quantity }} / 200 units</p>
      <div class="w-full bg-gray-200 rounded h-3 mt-2">
        <div class="{{ color }} h-3 rounded" style="width:{{ percent }}%"></div>
      </div>
    </div>
  {% endfor %}
</div>

<!-- Footer -->
<div class="py-6 text-center mt-12">
  <p class="text-gray-600 text-sm font-medium">
    Powered by Advanced Machine Learning & Predictive Analytics
  </p>
  <div class="inline-flex items-center gap-2 mt-2 px-4 py-1 rounded-full bg-yellow-400 text-black font-semibold text-sm shadow-md">
    âš¡ Walmart Sparkathon 2025
  </div>
</div>

<script>
function toggleAlerts() {
  document.getElementById("alertBox").classList.toggle("hidden");
}

function toggleFilter(){
  document.getElementById('filterPopup').classList.toggle('hidden');
}
const searchInput  = document.getElementById('searchInput');
const checkboxes   = document.querySelectorAll('.filter-checkbox');
const productCards = document.querySelectorAll('.product-card');
checkboxes.forEach(cb => cb.addEventListener('change', applyFilters));
searchInput.addEventListener('input', applyFilters);
function getCheckedValues(type){
  return [...document.querySelectorAll(`.filter-checkbox[data-filter="${type}"]:checked`)].map(cb => cb.value);
}
function match(card, attr, values){
  return values.length === 0 || values.includes(card.dataset[attr]);
}
function applyFilters(){
  const filters = {
    category     : getCheckedValues('category'),
    brand        : getCheckedValues('brand'),
    availability : getCheckedValues('availability'),
    price        : getCheckedValues('price'),
    rating       : getCheckedValues('rating')
  };
  const q = searchInput.value.toLowerCase();
  productCards.forEach(card => {
    const matchesSearch = card.innerText.toLowerCase().includes(q);
    const matchesAll = Object.entries(filters).every(([k, v]) => match(card, k, v));
    card.style.display = (matchesSearch && matchesAll) ? '' : 'none';
  });
}
</script>
</body>
</html>
